---
description: TDD開発の各フェーズ実行後に、完璧に実行されたか都度確認します。各コマンド実行後の品質チェックポイントを検証し、問題があれば修正提案を行います。
---

# TDD チェックポイント検証

TDD開発の各フェーズ実行後に、そのフェーズが完璧に実行されたかを確認します。

## 検証の目的

各TDDフェーズ（requirements/testcases/red/green/refactor）実行後に、そのフェーズの成果物が要求品質を満たしているかを検証し、次のフェーズに進む前に問題を早期発見します。

## 重要な原則

**⚠️ この工程では自動修正を行わない**
- この検証フェーズでは問題の検出と報告に専念する
- 問題を発見した場合は内容を詳細に報告する
- 修正が必要な場合はユーザーに明確に伝え、修正方針を提案する
- ユーザーの承認を得てから次のアクションを実行する

**✅ 完全実装の確認を徹底**
- すべての機能・要件が完全に実装されているかを厳密に検証
- 部分実装・仮実装・TODO・モックが残っていないかを確認
- 完全に実装されていない場合は、現在のフェーズの再実行を推奨
- 次のフェーズに進む前に、現在のフェーズを完璧に完了させる

## 使用方法

各TDDコマンド実行後に以下のように実行してください：

```bash
# 要件定義後
/tsumiki:tdd-requirements
/tsumiki:tdd-checkpoint

# テストケース洗い出し後
/tsumiki:tdd-testcases
/tsumiki:tdd-checkpoint

# Redフェーズ後
/tsumiki:tdd-red
/tsumiki:tdd-checkpoint

# Greenフェーズ後
/tsumiki:tdd-green
/tsumiki:tdd-checkpoint

# Refactorフェーズ後
/tsumiki:tdd-refactor
/tsumiki:tdd-checkpoint
```

## 検証手順

### 1. 現在のフェーズ特定

以下の優先順位で現在のフェーズを自動判定：

1. **最新のmemoファイル確認**: 最終更新セクションから現在フェーズを特定
2. **ファイル存在確認**:
   - `{feature_name}-refactor-phase.md` → Refactorフェーズ
   - `{feature_name}-green-phase.md` → Greenフェーズ
   - `{feature_name}-red-phase.md` → Redフェーズ
   - `{feature_name}-testcases.md` → Testcasesフェーズ
   - `{feature_name}-requirements.md` → Requirementsフェーズ
3. **ユーザー確認**: 自動判定できない場合はユーザーに確認

### 2. 事前準備

検証コンテキストの準備を行います：

1. **追加ルールの読み込み**
   - `AGENTS.md` ファイルが存在する場合は読み込み
   - `docs/rule` ディレクトリが存在する場合は読み込み
   - `docs/rule/tdd` ディレクトリが存在する場合は読み込み
   - `docs/rule/tdd/checkpoint` ディレクトリが存在する場合は読み込み
   - 各ディレクトリ内のすべてのファイルを読み込み、追加ルールとして適用

2. **関連ファイルを直接読み込み**
   - `docs/implements/{要件名}/{{task_id}}/{feature_name}-memo.md` - 開発履歴を確認
   - 現在のフェーズに応じた成果物ファイル（requirements/testcases/red-phase/green-phase/refactor-phase.md）
   - 実装ファイルとテストファイル（該当する場合）
   - **元タスクファイル（`docs/tasks/{taskfile}.md`）** - タスク定義と進捗を確認

3. **タスクファイルの解析**
   - タスクファイルから以下の情報を抽出：
     - タスクID、タスク名、優先度
     - 機能要件（Functional Requirements）
     - 完了条件（Acceptance Criteria）
     - 技術仕様（Technical Specifications）
     - 依存関係（Dependencies）
   - 現在実装中の機能がタスク定義と一致しているか確認

読み込み完了後、準備されたコンテキスト情報を基にチェックポイント検証を開始します。

### 3. フェーズ別検証

#### A. Requirements（要件定義）フェーズ

**検証ファイル**: `{feature_name}-requirements.md`

**検証項目**:

```markdown
## 📋 要件定義品質チェック

### ✅ 必須項目の完全性
- [ ] 機能の概要が明確に記載されている
- [ ] 入力・出力の仕様が具体的（型、範囲、制約）
- [ ] 制約条件が明確（パフォーマンス、セキュリティ、互換性）
- [ ] 想定される使用例が記載されている（基本パターン、エッジケース、エラーケース）
- [ ] EARS要件・設計文書との対応関係が明記されている

### 🎯 信頼性レベルの適切性
- [ ] 各項目に信頼性レベル（🔵🟡🔴）が記載されている
- [ ] 🔴（赤信号）が過度に多くない（全体の30%以下が望ましい）
- [ ] 重要な機能要件が🔴（推測）になっていない

### 📊 要件の明確性
- [ ] 曖昧な表現（「適切に」「うまく」等）が使われていない
- [ ] 数値的な基準が明確（処理時間、メモリ使用量等）
- [ ] エラーハンドリングの方針が明確

### 🔗 参照の完全性
- [ ] 参照した要件IDが具体的に記載されている
- [ ] 参照した設計文書のセクションが明記されている
- [ ] 技術スタック定義が確認されている

### 📋 タスクファイルとの整合性
- [ ] タスクファイル（docs/tasks/*.md）が読み込まれている
- [ ] 機能要件がタスクファイルの定義と一致している
- [ ] 完了条件（Acceptance Criteria）がカバーされている
- [ ] 技術仕様がタスクファイルの要求を満たしている
- [ ] タスクの優先度・依存関係が考慮されている

### 🔵🟡🔴 信頼性レベルの確認
- [ ] すべての要件項目に信頼性レベル（🔵🟡🔴）が記載されている
- [ ] 🔴（赤信号）が過度に多くない（全体の30%以下）
- [ ] 重要な機能要件が🔴（推測）になっていない
- [ ] EARS要件定義書・設計文書との対応関係が明記されている

### 📄 必須ファイルの確認
- [ ] `{feature_name}-requirements.md` ファイルが作成されている
- [ ] `{feature_name}-memo.md` ファイルが作成または更新されている
- [ ] memoファイルのRequirementsセクションに内容が記載されている
- [ ] 元タスクファイル（docs/tasks/*.md）へのパス参照が記載されている

### ✅ 完全実装の確認
- [ ] すべての機能要件が完全に定義されている（部分定義なし）
- [ ] 曖昧な記述・TODO・保留事項が残っていない
- [ ] 次フェーズで実装可能な具体性を持っている

### 品質判定
- 全項目✅ → **合格** （次フェーズへ進行可能）
- 1-2項目❌ → **要改善** （軽微な修正後に進行）
- 3項目以上❌ → **不合格** （要件定義の再実行が必要）
```

#### B. Testcases（テストケース）フェーズ

**検証ファイル**: `{feature_name}-testcases.md`

**検証項目**:

```markdown
## 📋 テストケース品質チェック

### ✅ テストケース分類の網羅性
- [ ] 正常系テストケースが定義されている（最低3件）
- [ ] 異常系テストケースが定義されている（最低2件）
- [ ] 境界値テストケースが定義されている（最低2件）
- [ ] 各テストケースに期待値が明確に記載されている

### 🎯 テストケースの具体性
- [ ] 入力値が具体的な値で記載されている
- [ ] 期待される結果が具体的に記載されている
- [ ] テストの目的が明確に説明されている
- [ ] 各テストケースに信頼性レベル（🔵🟡🔴）が記載されている

### 🛠️ 技術選択の明確性
- [ ] プログラミング言語が明記されている
- [ ] テストフレームワークが明記されている
- [ ] 技術選択の理由が説明されている

### 📝 コメント指針の明確性
- [ ] テストケース開始時のコメント形式が定義されている
- [ ] Given/When/Then各フェーズのコメント形式が定義されている
- [ ] expectステートメントのコメント形式が定義されている

### 🔗 要件との対応
- [ ] 要件定義書の全項目がテストケースでカバーされている
- [ ] テストケースと要件項目の対応関係が明確

### 📋 タスクファイルとの整合性
- [ ] タスクファイルの完了条件がテストケースとして定義されている
- [ ] タスクファイルの機能要件が全てテストでカバーされている
- [ ] タスクで定義された制約条件がテストケースに反映されている
- [ ] エッジケース・異常系がタスク要件から漏れなく抽出されている

### 🛠️ 技術選択の明確性
- [ ] プログラミング言語が明記されている
- [ ] テストフレームワークが明記されている
- [ ] 言語・フレームワーク選択の理由が説明されている
- [ ] 技術選択に信頼性レベル（🔵🟡🔴）が記載されている

### 📝 コメント指針の完全性
- [ ] テストケース開始時のコメント形式が定義されている
- [ ] Given/When/Then各フェーズのコメント形式が定義されている
- [ ] expectステートメントのコメント形式が定義されている
- [ ] セットアップ・クリーンアップのコメント形式が定義されている

### 🔵🟡🔴 信頼性レベルの確認
- [ ] すべてのテストケースに信頼性レベル（🔵🟡🔴）が記載されている
- [ ] 各テストケースの入力値・期待値・目的に信頼性レベルが付与されている

### 📄 必須ファイルの確認
- [ ] `{feature_name}-testcases.md` ファイルが作成されている
- [ ] `{feature_name}-memo.md` ファイルが更新されている
- [ ] memoファイルのTestcasesセクションに内容が記載されている

### ✅ 完全実装の確認
- [ ] すべてのテストケースが具体的な入力値・期待値で定義されている
- [ ] テストケースに未定義・TODO・保留が残っていない
- [ ] 次フェーズ（Red）で実装可能な具体性を持っている

### 品質判定
- 全項目✅ → **合格** （次フェーズへ進行可能）
- 1-2項目❌ → **要改善** （テストケースの追加・修正後に進行）
- 3項目以上❌ → **不合格** （テストケース洗い出しの再実行が必要）
```

#### C. Red（失敗テスト作成）フェーズ

**検証ファイル**: `{feature_name}-red-phase.md`、テストファイル

**検証項目**:

```markdown
## 📋 Redフェーズ品質チェック

### ✅ テストコードの実装状況
- [ ] 10件以上のテストケースが実装されている（または全テストケース）
- [ ] テストファイルが存在し、実行可能な状態である
- [ ] すべてのテストが失敗する状態である（未実装のため）

### 🎯 テストコードの品質
- [ ] Given-When-Then構造が明確である
- [ ] 各テストに日本語コメントが充実している
- [ ] テスト目的・内容・期待動作がコメントに記載されている
- [ ] 信頼性レベル（🔵🟡🔴）がコメントに記載されている

### 📝 コメントの充実度
- [ ] 【テスト目的】コメントが記載されている
- [ ] 【テスト内容】コメントが記載されている
- [ ] 【期待される動作】コメントが記載されている
- [ ] 【テストデータ準備】コメントが記載されている
- [ ] 【実際の処理実行】コメントが記載されている
- [ ] 【結果検証】コメントが記載されている
- [ ] 各expectに【確認内容】コメントが記載されている

### 🧪 テスト実行確認（Taskツールで実行）
- [ ] テストコマンドが実行できる
- [ ] 期待通りの失敗メッセージが出力される
- [ ] テストフレームワークが正しく動作している

### 🔗 テストケース定義との対応
- [ ] testcases.mdで定義したテストケースが実装されている
- [ ] 未実装のテストケースがリスト化されている

### 📋 タスクファイルとの整合性
- [ ] タスクファイルの完了条件がテストで検証可能になっている
- [ ] タスクで要求された機能がテストコードに反映されている
- [ ] タスクの技術仕様に沿ったテスト構造になっている

### 🎯 UIタスクの場合：E2Eテスト優先確認
- [ ] UIコンポーネント・画面機能の場合、E2Eテスト（Playwright推奨）を採用している
- [ ] ユーザーインタラクションをE2Eテストで検証している
- [ ] 画面遷移・フォーム機能をE2Eテストで確認している
- [ ] 非UIタスクの場合は単体・統合テストを採用している

### 📝 日本語コメントの充実度
- [ ] 各テストケースに【テスト目的】コメントが記載されている
- [ ] 各テストケースに【テスト内容】コメントが記載されている
- [ ] 各テストケースに【期待される動作】コメントが記載されている
- [ ] Given/When/Thenフェーズにコメントが記載されている
- [ ] 各expectステートメントに【確認内容】コメントが記載されている
- [ ] 各コメントに信頼性レベル（🔵🟡🔴）が記載されている

### 🧪 テスト実行確認（Taskツールで実行）
- [ ] テストコマンドが実行できる
- [ ] 期待通りの失敗メッセージが出力される
- [ ] テストフレームワークが正しく動作している
- [ ] テスト失敗の原因が明確である

### 📄 必須ファイルの確認
- [ ] `{feature_name}-red-phase.md` ファイルが作成されている
- [ ] `{feature_name}-memo.md` ファイルのRedフェーズセクションが更新されている
- [ ] テストファイルが実装され、配置されている

### ✅ 完全実装の確認
- [ ] すべてのテストケースが実装されている（未実装なし）
- [ ] すべてのテストが期待通りに失敗している
- [ ] .skip、.only、コメントアウトされたテストがない
- [ ] モック・スタブが適切に定義されている（該当する場合）
- [ ] テストコードに TODO・保留コメントが残っていない

### 📄 ドキュメント更新
- [ ] red-phase.mdに実装内容が記載されている
- [ ] memoファイルのRedフェーズセクションが更新されている
- [ ] 期待される失敗メッセージが記載されている

### 品質判定
- 全項目✅ → **合格** （次フェーズへ進行可能）
- 1-3項目❌ → **要改善** （軽微な修正後に進行）
- 4項目以上❌ → **不合格** （Redフェーズの再実行が必要）
```

#### D. Green（実装）フェーズ

**検証ファイル**: `{feature_name}-green-phase.md`、実装ファイル、テストファイル

**検証項目**:

```markdown
## 📋 Greenフェーズ品質チェック

### ✅ テスト成功状況（Taskツールで実行）
- [ ] Redフェーズで作成した全テストが成功している
- [ ] 既存の全テストが引き続き成功している
- [ ] テストカバレッジが要求水準を満たしている

### 🎯 実装コードの品質
- [ ] 実装ファイルが存在し、必要な機能が実装されている
- [ ] 各関数・メソッドに日本語コメントが充実している
- [ ] 信頼性レベル（🔵🟡🔴）がコメントに記載されている

### 📝 コメントの充実度
- [ ] 【機能概要】コメントが記載されている
- [ ] 【実装方針】コメントが記載されている
- [ ] 【テスト対応】コメントが記載されている
- [ ] 【入力値検証】コメントが記載されている（該当する場合）
- [ ] 【エラー処理】コメントが記載されている（該当する場合）

### 🚫 禁止事項の遵守
- [ ] テストのスキップがない（.skip使用なし）
- [ ] 必要なテストの削除がない
- [ ] 実装コード内でのモック・スタブ記述がない
- [ ] 実装コード内でDBに代わるインメモリーストレージを使用していない
- [ ] DB操作を省略していない

### 📏 ファイルサイズ
- [ ] 実装ファイルが800行以下である
- [ ] 800行を超える場合は分割計画が記載されている

### 📋 タスクファイルとの整合性
- [ ] タスクファイルの機能要件が実装されている
- [ ] タスクファイルの完了条件が全て満たされている
- [ ] タスクで指定された技術仕様に従って実装されている
- [ ] タスクの制約条件（パフォーマンス、セキュリティ等）が実装に反映されている
- [ ] 依存タスクの完了が確認されている（該当する場合）

### 📝 日本語コメントの充実度
- [ ] 各関数・メソッドに【機能概要】コメントが記載されている
- [ ] 各関数・メソッドに【実装方針】コメントが記載されている
- [ ] 各関数・メソッドに【テスト対応】コメントが記載されている
- [ ] 処理ブロックに【入力値検証】【データ処理】等のコメントが記載されている
- [ ] エラーハンドリングに【エラー処理】コメントが記載されている
- [ ] 各コメントに信頼性レベル（🔵🟡🔴）が記載されている

### 🧪 テスト実行確認（Taskツールで実行必須）
- [ ] Taskツールを使用してテストを実行した
- [ ] すべてのテストが成功している
- [ ] 既存のテストも引き続き成功している
- [ ] テストカバレッジが要求水準を満たしている

### 🚫 禁止事項の遵守
- [ ] 必要なテストのスキップがない（.skip使用なし）
- [ ] 必要なテストの削除がない
- [ ] 実装コード内でのモック・スタブ記述がない
- [ ] 実装コード内でDBに代わるインメモリーストレージを使用していない
- [ ] DB操作を省略していない

### 📏 コード品質の確認
- [ ] lintエラーが解消されている
- [ ] typecheckエラーが解消されている
- [ ] フォーマットが統一されている

### 📄 必須ファイルの確認
- [ ] `{feature_name}-green-phase.md` ファイルが作成されている
- [ ] `{feature_name}-memo.md` ファイルのGreenフェーズセクションが更新されている
- [ ] 実装ファイルが配置されている

### ✅ 完全実装の確認
- [ ] すべての機能が完全に実装されている（部分実装なし）
- [ ] すべてのテストが成功している（.skip、コメントアウトなし）
- [ ] 実装コードに TODO・FIXME・保留コメントが残っていない
- [ ] モック・スタブ・仮実装が本番実装に置き換わっている
- [ ] エラーハンドリングが完全に実装されている
- [ ] 全ての関数・メソッドが完全に実装されている（throw new Error なし）

### 📄 ドキュメント更新
- [ ] green-phase.mdに実装内容が記載されている
- [ ] memoファイルのGreenフェーズセクションが更新されている
- [ ] テスト結果が記載されている
- [ ] 次のRefactorフェーズでの改善点が記載されている
- [ ] タスクファイルの進捗状況が更新されている

### 品質判定
- 全項目✅ → **合格** （次フェーズへ進行可能）
- 1-3項目❌ → **要改善** （修正後に進行）
- 4項目以上❌ → **不合格** （Greenフェーズの再実行が必要）
```

#### E. Refactor（リファクタリング）フェーズ

**検証ファイル**: `{feature_name}-refactor-phase.md`、実装ファイル、テストファイル

**検証項目**:

```markdown
## 📋 Refactorフェーズ品質チェック

### ✅ テスト継続成功（Taskツールで実行）
- [ ] リファクタリング後も全テストが成功している
- [ ] テストカバレッジが維持または向上している
- [ ] 新規テストが必要に応じて追加されている

### 🎯 コード品質の改善
- [ ] 変数名・関数名が分かりやすく改善されている
- [ ] 重複コードが除去されている（DRY原則）
- [ ] コードの構造が分かりやすく整理されている
- [ ] 単一責任原則が適用されている

### 📏 ファイルサイズの最適化
- [ ] 実装ファイルが500行以下である
- [ ] 長大なファイルが機能別に分割されている
- [ ] 適切なモジュール境界が設定されている

### 🔧 コード品質ツール確認（Taskツールで実行）
- [ ] lintエラーが解消されている
- [ ] typecheckエラーが解消されている
- [ ] フォーマットが統一されている

### 🛡️ セキュリティレビュー
- [ ] 入力値検証が適切に実装されている
- [ ] SQLインジェクション対策が確認されている（該当する場合）
- [ ] XSS対策が確認されている（該当する場合）
- [ ] 認証・認可が適切に実装されている（該当する場合）

### ⚡ パフォーマンスレビュー
- [ ] アルゴリズムの計算量が適切である
- [ ] 不要な処理が削除されている
- [ ] データベースクエリが最適化されている（該当する場合）
- [ ] 非同期処理が適切に実装されている（該当する場合）

### 🚫 禁止事項の遵守
- [ ] 実装コード内でのモック・スタブ記述がない
- [ ] 実装コード内でDBに代わるインメモリーストレージを使用していない

### 📋 タスクファイルとの最終整合性チェック
- [ ] タスクファイルの全機能要件が実装完了している
- [ ] タスクファイルの全完了条件が満たされている
- [ ] タスクで要求された非機能要件（パフォーマンス、セキュリティ等）が達成されている
- [ ] タスクの技術仕様に完全準拠している
- [ ] タスク完了報告が可能な状態である

### 🔧 リファクタリング観点の確認
- [ ] 変数名・関数名が分かりやすく改善されている
- [ ] 重複コードが除去されている（DRY原則）
- [ ] コードの構造が分かりやすく整理されている
- [ ] 単一責任原則が適用されている

### 📏 ファイルサイズの最適化
- [ ] 実装ファイルが500行以下である
- [ ] 長大なファイルが機能別に分割されている
- [ ] 適切なモジュール境界が設定されている

### 🔧 コード品質ツール確認（Taskツールで実行必須）
- [ ] Taskツールを使用してlintを実行し、エラーが解消されている
- [ ] Taskツールを使用してtypecheckを実行し、エラーが解消されている
- [ ] フォーマットが統一されている

### 🛡️ セキュリティレビュー
- [ ] 入力値検証が適切に実装されている
- [ ] SQLインジェクション対策が確認されている（該当する場合）
- [ ] XSS対策が確認されている（該当する場合）
- [ ] 認証・認可が適切に実装されている（該当する場合）
- [ ] セキュリティレビュー結果がdocsに記載されている

### ⚡ パフォーマンスレビュー
- [ ] アルゴリズムの計算量が適切である
- [ ] 不要な処理が削除されている
- [ ] データベースクエリが最適化されている（該当する場合）
- [ ] 非同期処理が適切に実装されている（該当する場合）
- [ ] パフォーマンスレビュー結果がdocsに記載されている

### 🚫 禁止事項の遵守
- [ ] 実装コード内でのモック・スタブ記述がない
- [ ] 実装コード内でDBに代わるインメモリーストレージを使用していない

### 🧪 テスト継続成功（Taskツールで実行必須）
- [ ] Taskツールを使用してテストを実行した
- [ ] リファクタリング後も全テストが成功している
- [ ] テストカバレッジが維持または向上している
- [ ] 新規テストが必要に応じて追加されている

### 🧹 開発時生成ファイルのクリーンアップ
- [ ] 開発中に作成された一時ファイルが削除されている
- [ ] debug-*.js、test-*.js、temp-*.js等のパターンファイルがない
- [ ] *.tmp、*.bak、*~等のバックアップファイルがない
- [ ] 削除したファイルと削除理由がログに記録されている

### 📝 日本語コメントの強化
- [ ] 各関数に【改善内容】【設計方針】コメントが追加されている
- [ ] ヘルパー関数に【再利用性】【単一責任】コメントが記載されている
- [ ] 定数・設定値に【設定定数】【調整可能性】コメントが記載されている
- [ ] エラーハンドリングに【詳細エラー処理】コメントが記載されている
- [ ] 各コメントに信頼性レベル（🔵🟡🔴）が記載されている

### 📄 必須ファイルの確認
- [ ] `{feature_name}-refactor-phase.md` ファイルが作成されている
- [ ] `{feature_name}-memo.md` ファイルのRefactorフェーズセクションが更新されている
- [ ] セキュリティレビュー結果が記載されている
- [ ] パフォーマンスレビュー結果が記載されている

### ✅ 最終完全実装の確認
- [ ] **すべての機能が完全に実装されている**（例外なし）
- [ ] **すべてのテストが成功している**（.skip、コメントアウト、失敗なし）
- [ ] **TODO・FIXME・保留コメントが一切残っていない**
- [ ] **モック・スタブ・仮実装が完全に削除されている**
- [ ] **部分実装・未完成機能が存在しない**
- [ ] **本番環境にデプロイ可能な品質である**

### 📄 ドキュメント更新
- [ ] refactor-phase.mdに改善内容が記載されている
- [ ] memoファイルのRefactorフェーズセクションが更新されている
- [ ] セキュリティレビュー結果が記載されている
- [ ] パフォーマンスレビュー結果が記載されている
- [ ] 最終的な品質評価が記載されている
- [ ] タスクファイルに完了マークが記録されている

### 品質判定
- 全項目✅ → **合格** （verify-completeフェーズへ進行可能）
- 1-3項目❌ → **要改善** （修正後に進行）
- 4項目以上❌ → **不合格** （Refactorフェーズの再実行が必要）
```

#### F. Verify-Complete（完全性検証）フェーズ

**検証ファイル**: すべてのフェーズファイル、テストファイル、実装ファイル、元タスクファイル

**検証項目**:

```markdown
## 📋 完全性検証品質チェック

### ✅ 既存テストのグリーン状態確認（Taskツールで実行必須）
- [ ] Taskツールを使用して全テストを実行した
- [ ] すべての既存テストが成功している
- [ ] テスト失敗がある場合はmemoファイルに記載されている
- [ ] この工程では修正を行わず、記録のみ実施している

### 📋 予定テストケースの確認
- [ ] requirements.mdから予定テストケース総数を確認した
- [ ] 正常系・異常系・エッジケース等の分類を確認した
- [ ] testcases.mdで定義されたテストケースを全て確認した

### ✅ 実装済みテストケースの確認
- [ ] 現在のテストファイルを全て確認した
- [ ] 実装済みテストケース数をカウントした
- [ ] 各テストケースの内容を予定と照合した
- [ ] テスト成功率を計算した（成功数/実装数）

### 📊 要件定義書網羅性チェック
- [ ] requirements.mdの全項目を確認した
- [ ] 入力パラメータの実装・テスト状況を確認した
- [ ] 出力仕様の実装・テスト状況を確認した
- [ ] 制約条件の実装・テスト状況を確認した
- [ ] 基本使用例の実装・テスト状況を確認した
- [ ] エッジケースの実装・テスト状況を確認した
- [ ] エラーケースの実装・テスト状況を確認した
- [ ] 要件網羅率を計算した（実装済み項目数/総項目数）

### 📊 実装率の分析
- [ ] 全体実装率を計算した（実装数/予定数）
- [ ] 正常系実装率を計算した
- [ ] 異常系実装率を計算した
- [ ] エッジケース実装率を計算した

### ❌ 未実装テストケースの特定
- [ ] 未実装テストケースを全てリスト化した
- [ ] 各未実装テストケースの種類を分類した
- [ ] 各未実装テストケースの重要度を評価した
- [ ] 各未実装テストケースの要件項目を特定した

### 📄 memoファイルの統合更新
- [ ] 既存のmemoファイル内容を確認した
- [ ] 重要情報（技術的学習ポイント、再利用可能パターン）を抽出した
- [ ] 重複・詳細な経過記録を削除した
- [ ] 最終結果セクションを作成・更新した
- [ ] 確認すべきドキュメントのリストを更新した
- [ ] 実装率・品質判定・TODO更新状況を記載した
- [ ] 重要な技術学習をまとめた
- [ ] 注意点・修正が必要な項目を記載した（該当する場合）

### 📝 元タスクファイルの完了マーク更新
- [ ] 現在のTDD開発対象タスクを元タスクファイルから特定した
- [ ] 完了条件を全て満たしているか確認した
- [ ] 該当タスクに✅完了マークを追加した
- [ ] 完了理由（テスト数、要件網羅率等）を記載した
- [ ] 関連するサブタスクに[x]チェックマークを追加した

### 🚫 修正禁止の遵守
- [ ] この工程では一切の修正作業を行っていない
- [ ] 問題点はすべてmemoファイルに記録している
- [ ] 修正方針を後工程向けに明記している

### 品質判定
- 既存テスト状態: すべてグリーン AND 要件網羅率: 100% AND テスト成功率: 100% → **合格** （次のTDDサイクルへ）
- 上記以外 → **要改善** （実装不足・テスト失敗あり、memoファイルに記録済み）
```

## 検証結果の出力形式

### 合格の場合

```
✅ **チェックポイント検証: 合格**

📊 [{フェーズ名}]フェーズ品質評価:
- 検証項目総数: {総数}項目
- 合格項目: {合格数}項目
- 品質スコア: 100%

🎯 確認された成果物:
- {成果物1}: 品質基準を満たしています
- {成果物2}: 品質基準を満たしています

📋 タスク進捗状況:
- タスクID: {task_id}
- タスク名: {task_name}
- 完了条件達成率: {達成率}%
- 機能要件実装状況: {実装数}/{総数}
- 技術仕様準拠: ✅

✨ 次のお勧めステップ:
`{次のコマンド}` で次のフェーズを開始します。
```

### 要改善の場合

```
⚠️ **チェックポイント検証: 要改善**

📊 [{フェーズ名}]フェーズ品質評価:
- 検証項目総数: {総数}項目
- 合格項目: {合格数}項目
- 要改善項目: {改善数}項目
- 品質スコア: {スコア}%

❌ 改善が必要な項目:
1. **{改善項目1}**
   - **問題**: {具体的な問題内容}
   - **影響**: {この問題が及ぼす影響}
   - **修正方針**: {推奨される修正方法}

2. **{改善項目2}**
   - **問題**: {具体的な問題内容}
   - **影響**: {この問題が及ぼす影響}
   - **修正方針**: {推奨される修正方法}

📋 タスク進捗状況:
- タスクID: {task_id}
- タスク名: {task_name}
- 完了条件達成率: {達成率}%
- 未達成の完了条件: {リスト}
- タスク定義との乖離: {具体的な乖離内容}

🔧 推奨アクション:
これらの項目を修正してから次のフェーズに進むことを推奨します。

**完全実装されていない項目がある場合:**
1. 現在のフェーズのコマンド（`{現在のコマンド}`）を再実行
2. 未完了の実装・定義を完全に仕上げる
3. TODO・保留・仮実装を全て解消
4. 修正後、再度 `/tsumiki:tdd-checkpoint` で検証
5. 全項目が✅になるまで繰り返す

**次のフェーズに進めるのは、完全実装が確認されてからです。**
```

### 不合格の場合

```
❌ **チェックポイント検証: 不合格**

📊 [{フェーズ名}]フェーズ品質評価:
- 検証項目総数: {総数}項目
- 合格項目: {合格数}項目
- 不合格項目: {不合格数}項目
- 品質スコア: {スコア}%

🚨 重大な問題:
1. **{不合格項目1}**
   - **問題**: {具体的な問題内容}
   - **影響**: {この問題が及ぼす重大な影響}
   - **必須対応**: {必須の修正内容}

2. **{不合格項目2}**
   - **問題**: {具体的な問題内容}
   - **影響**: {この問題が及ぼす重大な影響}
   - **必須対応**: {必須の修正内容}

📋 タスク進捗状況:
- タスクID: {task_id}
- タスク名: {task_name}
- 完了条件達成率: {達成率}%
- 重大な未達成項目: {リスト}
- タスク完了可否: ❌ 不可

⛔ 必須アクション:
品質基準を満たしていないため、次のフェーズに進むことはできません。

**完全実装未達の場合は以下を実施してください:**
1. **現在のフェーズを最初からやり直す**: `{現在のコマンド}` を再実行
2. **完全実装を徹底する**:
   - すべての機能を完全に実装
   - TODO・FIXME・保留コメントを全て削除
   - モック・スタブ・仮実装を本番実装に置き換え
   - 部分実装・未完成機能を完全に仕上げる
3. **検証を再実行**: `/tsumiki:tdd-checkpoint` で完全実装を確認
4. **全項目が✅になるまで繰り返す**

**⚠️ 重要**: 次のフェーズに進む前に、現在のフェーズを完璧に完了させることが必須です。
```

## 自動遷移判定

### 品質スコアによる判定

```
✅ 合格 (100%):
- 全検証項目が基準を満たしている
- 次のフェーズへの進行を推奨

⚠️ 要改善 (80-99%):
- 大部分の項目は基準を満たしている
- 軽微な改善後、次のフェーズへの進行可能
- ユーザー判断で進行するかどうか決定

❌ 不合格 (<80%):
- 重要な項目が基準を満たしていない
- 現在のフェーズを再実行する必要がある
- 次のフェーズへの進行は非推奨
```

## 検証記録

検証結果は以下に自動記録されます：

1. **memoファイル**: 各フェーズセクションに「チェックポイント検証結果」を追記
2. **checkpoint-log.md**: 全チェックポイント検証の履歴を記録（新規作成）

```markdown
# チェックポイント検証履歴

## [{日時}] {フェーズ名}フェーズ検証

### 検証結果: {合格/要改善/不合格}

### 品質スコア: {スコア}%

### 詳細:
- 合格項目: {リスト}
- 改善項目: {リスト}
- 不合格項目: {リスト}

### アクション:
- {実施したアクション}
```

## 使用例

### 完全なTDDサイクルの例

```bash
# 【フェーズ1】要件定義
/tsumiki:tdd-requirements feature_name="ユーザー認証"

# チェックポイント検証
/tsumiki:tdd-checkpoint
# 検証内容:
# ✓ 信頼性レベル（🔵🟡🔴）の記載確認
# ✓ タスクファイル整合性チェック
# ✓ requirements.md、memo.md作成確認
# ✓ 完全実装の確認
# → 結果: 合格 / 要改善 / 不合格

# 問題があれば修正後に再検証
/tsumiki:tdd-checkpoint
# → 全項目✅で次フェーズへ


# 【フェーズ2】テストケース洗い出し
/tsumiki:tdd-testcases

# チェックポイント検証
/tsumiki:tdd-checkpoint
# 検証内容:
# ✓ 技術選択の明確性（言語、フレームワーク）
# ✓ コメント指針の完全性
# ✓ 信頼性レベルの記載確認
# ✓ testcases.md、memo.md更新確認
# ✓ 完全実装の確認
# → 結果報告


# 【フェーズ3】Red（失敗テスト作成）
/tsumiki:tdd-red

# チェックポイント検証
/tsumiki:tdd-checkpoint
# 検証内容:
# ✓ UIタスクの場合: E2Eテスト優先確認
# ✓ 日本語コメントの充実度確認
# ✓ Taskツールによるテスト実行確認
# ✓ 期待通りの失敗メッセージ確認
# ✓ red-phase.md、memo.md更新確認
# ✓ 完全実装の確認（.skip、コメントアウトなし）
# → 結果報告


# 【フェーズ4】Green（実装）
/tsumiki:tdd-green

# チェックポイント検証
/tsumiki:tdd-checkpoint
# 検証内容:
# ✓ 日本語コメントの充実度確認
# ✓ Taskツールによるテスト成功確認
# ✓ 禁止事項の遵守（.skip、モック、DB省略なし）
# ✓ コード品質確認（lint、typecheck）
# ✓ green-phase.md、memo.md更新確認
# ✓ 完全実装の確認（TODO、仮実装なし）
# → 結果報告


# 【フェーズ5】Refactor（品質改善）
/tsumiki:tdd-refactor

# チェックポイント検証
/tsumiki:tdd-checkpoint
# 検証内容:
# ✓ リファクタリング観点の確認
# ✓ ファイルサイズの最適化（500行以下）
# ✓ Taskツールによるlint、typecheck確認
# ✓ セキュリティレビュー
# ✓ パフォーマンスレビュー
# ✓ 開発時生成ファイルのクリーンアップ
# ✓ 日本語コメントの強化
# ✓ Taskツールによるテスト継続成功確認
# ✓ refactor-phase.md、memo.md更新確認
# ✓ 最終完全実装の確認
# → 結果報告


# 【フェーズ6】Verify-Complete（完全性検証）
/tsumiki:tdd-verify-complete

# チェックポイント検証
/tsumiki:tdd-checkpoint
# 検証内容:
# ✓ Taskツールによる全テストグリーン確認
# ✓ 予定テストケースの確認
# ✓ 実装済みテストケースの確認
# ✓ 要件定義書網羅性チェック（100%目標）
# ✓ 実装率の分析
# ✓ 未実装テストケースの特定
# ✓ memoファイルの統合更新
# ✓ 元タスクファイルの完了マーク更新
# ✓ 修正禁止の遵守
# → 結果: 合格（次のTDDサイクルへ） / 要改善（記録済み）
```

## 検証機能の全体像とメリット

この強化されたチェックポイント検証により、以下が実現されます：

### 1. **各TDDコマンドの実際の動作に基づく検証**
- 各フェーズで実際に生成される成果物を正確に検証
- コマンドの品質基準と完全に一致した検証項目
- 実際の開発フローに即した現実的なチェックポイント

### 2. **タスク要件との自動整合性チェック**
- タスクファイルで定義された機能要件・完了条件の漏れなき実装確認
- タスク進捗の可視化（達成率の数値化）
- 元タスクファイルへの自動完了マーク追加

### 3. **信頼性レベル（🔵🟡🔴）による品質保証**
- すべての要件・テストケース・実装に信頼性レベルを記載
- EARS要件定義書・設計文書との対応関係の明確化
- 推測による実装の削減（🔴を30%以下に抑制）

### 4. **UIタスク向けE2Eテスト優先の徹底**
- UIコンポーネント・画面機能にPlaywright等のE2Eテストを優先適用
- ユーザーインタラクションの実際の動作確認
- 非UIタスクは単体・統合テストで効率的に検証

### 5. **日本語コメントの充実度確認**
- 【テスト目的】【機能概要】【実装方針】等の必須コメント確認
- Given/When/Thenフェーズのコメント充実度検証
- 信頼性レベル付きコメントの網羅性確認

### 6. **Taskツールによる実行確認の徹底**
- テスト実行は必ずTaskツールで実施
- lint、typecheckの実行確認
- 実際の動作確認による品質保証

### 7. **禁止事項の厳格な遵守確認**
- .skip、.only、コメントアウトされたテストの検出
- 実装コード内でのモック・スタブ記述の検出
- DB操作省略、インメモリーストレージ使用の検出

### 8. **セキュリティ・パフォーマンスレビューの実施**
- SQLインジェクション、XSS、認証・認可の確認
- アルゴリズムの計算量、データベースクエリの最適化
- レビュー結果のドキュメント化

### 9. **開発時生成ファイルのクリーンアップ**
- debug-*.js、test-*.js、*.tmp等の一時ファイル検出・削除
- プロフェッショナルなワークスペース維持

### 10. **完全性検証（Verify-Complete）**
- 要件定義書網羅率100%の達成確認
- 全テストグリーン状態の確認
- memoファイルの統合更新と元タスクファイルの完了マーク自動追加
- 修正禁止の原則遵守による記録・報告の徹底

### 11. **完全実装の徹底確認**
- TODO・FIXME・保留コメントの完全排除
- モック・スタブ・仮実装の本番実装への置き換え
- 部分実装・未完成機能の検出と修正推奨

この検証により、各TDDフェーズの品質と完全性を確保し、タスクファイルとの一貫性を保ちながら、実際のコマンド動作に基づいた現実的で効果的な開発進行を実現します。
